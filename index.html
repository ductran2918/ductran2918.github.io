<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mapping Southeast Asian founders in the US</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/topojson-client@3"></script>
</head>
<body>
  <h1>Mapping Southeast Asian founders in the US</h1>
  <div id="map"></div>

  <!-- Modal for click details -->
  <div id="modal" class="hidden">
    <div id="modal-content">
      <button id="close-modal">Ã—</button>
      <h2 id="modal-state"></h2>
      <ul id="founder-list"></ul>
    </div>
  </div>

  <script>
  (async function(){
    const width = 960, height = 600;
    const svg = d3.select("#map")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

    // 1) Load topology and CSV
    const [us, data] = await Promise.all([
      d3.json("us-states.topojson"),
      d3.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQufUsi2JP4GslKrQa6Dkys0VZSvz6NgX2Bt_FiZ4i8bXfFwp-9hYpu0m2OPmye_vX8DFvf02uleg_v/pub?gid=150219922&single=true&output=csv")
    ]);

    // 2) Aggregate counts by state & group founders
    const byState = d3.rollups(
      data,
      rows => ({
        count: rows.length,
        founders: rows.map(r => ({
          name: r.founder,
          company: r.company,
          year: r.founded_year,
          vertical: r.vertical
        }))
      }),
      d => d.state
    );
    const stateData = new Map(byState);

    // 3) Set up color scale with 5 bins
    const counts = Array.from(stateData.values()).map(d=>d.count);
    const allCounts = [...counts, 0];
    const maxCount = d3.max(allCounts);
    const bins = d3.scaleQuantize([0, maxCount],
      ["#d1dff6","#c2d6f6","#b2cbf2","#a0bff0","#92b6f0"]
    );

    // 4) Draw the map
    const path = d3.geoPath().projection(d3.geoAlbersUsa());
    const states = topojson.feature(us, us.objects.states).features;
    svg.selectAll("path")
      .data(states)
      .enter().append("path")
        .attr("d", path)
        .attr("fill", d => {
          const name = d.properties.name;
          const st = stateData.get(name);
          return bins(st ? st.count : 0);
        })
        .on("mouseover", (e, d) => {
          const name = d.properties.name;
          const c = stateData.get(name)?.count || 0;
          d3.select("#map").append("div")
            .attr("class","tooltip")
            .style("left",(e.pageX+10)+"px")
            .style("top",(e.pageY+10)+"px")
            .text(`${name}: ${c} founder${c===1?"":"s"}`);
        })
        .on("mouseout", () => d3.selectAll(".tooltip").remove())
        .on("click", (e, d) => {
          const name = d.properties.name;
          const info = stateData.get(name);
          const list = d3.select("#founder-list").html("");
          if (info) {
            info.founders.forEach(f => {
              list.append("li").text(
                `${f.name} (${f.company}, ${f.year}, ${f.vertical})`
              );
            });
          } else {
            list.append("li").text("No founders");
          }
          d3.select("#modal-state").text(name);
          d3.select("#modal").classed("hidden", false);
        });

    // 5) Modal close
    d3.select("#close-modal").on("click", () => {
      d3.select("#modal").classed("hidden", true);
    });
  })();
  </script>
</body>
</html>
